{% extends 'base.html' %}
{% block title %}Profil de {{ profile_user.username }}{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- Header Section -->
    <div class="profile-header">
        <a href="{% url 'logout' %}" class="nav-link floating-btn">
            <i class="fas fa-sign-out-alt"></i>
        </a>
        <div class="profile-banner">
            <div class="banner-overlay"></div>
            <div class="animated-shapes">
                <div class="shape shape-1"></div>
                <div class="shape shape-2"></div>
                <div class="shape shape-3"></div>
            </div>
        </div>
        
        <!-- Avatar Section with Partner Display -->
        <div class="profile-avatar-section">
            <div class="avatar-container">
                {% if profile_user.relationship_status == 'RELATIONSHIP' or profile_user.relationship_status == 'MARRIED' and profile_user.partner %}
                <div class="couple-avatars">
                    <div class="partner-avatar">
                        {% if profile_user.partner.profile_picture %}
                            <img src="{{ profile_user.partner.profile_picture.url }}" alt="{{ profile_user.partner.username }}" class="profile-picture">
                        {% else %}
                            <span class="avatar-initials">{{ profile_user.partner.username|first|upper }}</span>
                        {% endif %}
                        <div class="partner-name">{{ profile_user.partner.username }}</div>
                    </div>
                    <div class="main-avatar">
                        <div class="avatar-circle pulse-animation">
                            {% if profile_user.profile_picture %}
                                <img src="{{ profile_user.profile_picture.url }}" alt="{{ profile_user.username }}" class="profile-picture">
                            {% else %}
                                <span class="avatar-initials">{{ profile_user.username|first|upper }}</span>
                            {% endif %}
                            <div class="avatar-ring"></div>
                        </div>
                        {% if request.user == profile_user %}
                            <div class="profile-picture-upload">
                                <form method="post" enctype="multipart/form-data" action="{% url 'update_profile_picture' %}">
                                    {% csrf_token %}
                                    <input type="file" name="profile_picture" id="profile-picture-input" accept="image/*" style="display: none;">
                                    <label for="profile-picture-input" class="upload-button floating-btn">
                                        <i class="fas fa-camera"></i>
                                    </label>
                                    <button type="submit" class="save-button floating-btn">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="single-avatar">
                    <div class="avatar-circle pulse-animation">
                        {% if profile_user.profile_picture %}
                            <img src="{{ profile_user.profile_picture.url }}" alt="{{ profile_user.username }}" class="profile-picture">
                        {% else %}
                            <span class="avatar-initials">{{ profile_user.username|first|upper }}</span>
                        {% endif %}
                        <div class="avatar-ring"></div>
                    </div>
                    {% if request.user == profile_user %}
                        <div class="profile-picture-upload">
                            <form method="post" enctype="multipart/form-data" action="{% url 'update_profile_picture' %}">
                                {% csrf_token %}
                                <input type="file" name="profile_picture" id="profile-picture-input" accept="image/*" style="display: none;">
                                <label for="profile-picture-input" class="upload-button floating-btn">
                                    <i class="fas fa-camera"></i>
                                </label>
                                <button type="submit" class="save-button floating-btn">
                                    <i class="fas fa-check"></i>
                                </button>
                            </form>
                        </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <div class="profile-info">
                <h1 class="profile-username glitch" data-text="{{ profile_user.username }}">{{ profile_user.username }}</h1>
                <p class="profile-bio">Membre depuis {{ profile_user.date_joined|date:"F Y" }}</p>
                
                <!-- Relationship Status Badge -->
                <div class="relationship-status-badge">
                    {% if profile_user.relationship_status == 'SINGLE' %}
                        <span class="status-single">üôÇ C√©libataire</span>
                    {% elif profile_user.relationship_status == 'RELATIONSHIP' %}
                        <span class="status-relationship">üíë En couple</span>
                    {% elif profile_user.relationship_status == 'MARRIED' %}
                        <span class="status-married">üíç Mari√©(e)</span>
                    {% elif profile_user.relationship_status == 'COMPLICATED' %}
                        <span class="status-complicated">üòµ C'est compliqu√©</span>
                    {% endif %}
                </div>
                
                {% if request.user != profile_user %}
                <form method="POST" action="{% url 'report_user' profile_user.id %}" class="report-form">
                    {% csrf_token %}
                    <input type="hidden" name="reason" value="Comportement inappropri√©">
                    <button type="submit" class="report-button floating-btn">
                        <i class="fas fa-flag"></i>
                    </button>
                </form>
                {% endif %}

                {% if user.is_authenticated and user != profile_user %}
                <button class="subscribe-btn floating-btn" 
                        data-account-id="{{ profile_user.id }}" 
                        data-action="{% if is_subscribed %}unsubscribe{% else %}subscribe{% endif %}">
                    {% if is_subscribed %}<i class="fas fa-user-minus"></i>{% else %}<i class="fas fa-user-plus"></i>{% endif %}
                </button>
                {% else %}
                    <p class="login-prompt">Veuillez vous connecter pour vous abonner.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- User Details Section -->
    <div class="user-details-grid">
        <!-- Schools Section -->
        {% if profile_user.schools %}
        <div class="detail-card">
            <div class="detail-card-header">
                <i class="fas fa-graduation-cap"></i>
                <h3>Formation</h3>
            </div>
            <div class="detail-card-content">
                {% for school in profile_user.schools %}
                <div class="school-item">
                    <div class="school-name">{{ school.name }}</div>
                    <div class="school-years">
                        {{ school.start_year }} - {% if school.end_year %}{{ school.end_year }}{% else %}Pr√©sent{% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Hobbies Section -->
        {% if profile_user.hobbies %}
        <div class="detail-card">
            <div class="detail-card-header">
                <i class="fas fa-heart"></i>
                <h3>Loisirs & Centres d'int√©r√™t</h3>
            </div>
            <div class="detail-card-content">
                <div class="hobbies-list">
                    {% for hobby in profile_user.hobbies %}
                    <span class="hobby-tag">{{ hobby }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Edit Profile Button -->
        {% if request.user == profile_user %}
        <div class="detail-card full-width">
            <div class="detail-card-content">
                <a href="{% url 'profile_details' %}" class="action-button edit-profile floating-btn">
                    <i class="fas fa-user-edit"></i> Modifier le profil
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Stats Section -->
    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-value" data-count="{{ followers_count }}">0</div>
            <div class="stat-label">Abonn√©s</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-eye"></i>
            </div>
            <div class="stat-value" data-count="{{ following_count }}">0</div>
            <div class="stat-label">Abonnements</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-value" data-count="{{ publications_count }}">0</div>
            <div class="stat-label">Publications</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-plus-circle"></i>
            </div>
            <div class="stat-value" data-count="{{ clubs_created_count }}">0</div>
            <div class="stat-label">Clubs cr√©√©s</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-value" data-count="{{ clubs_joined_count }}">0</div>
            <div class="stat-label">Clubs suivis</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-value" data-count="{{ profile_user.score }}">0</div>
            <div class="stat-label">Score</div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        {% if request.user == profile_user %}
            <a href="{% url 'publication_create' %}" class="action-button create-publication floating-btn">
                <i class="fas fa-plus"></i>
                <span>Publication</span>
            </a>
            <a href="{% url 'club_create' %}" class="action-button create-club floating-btn">
                <i class="fas fa-plus"></i>
                <span>Club</span>
            </a>
            <a href="{% url 'page_create' %}" class="action-button create-page floating-btn">
                <i class="fas fa-plus"></i>
                <span>Page</span>
            </a>
        {% endif %}
    </div>

    <!-- Publications Section -->
    <div class="publications-section">
        <h2 class="section-title">
            <span>Publications de {{ profile_user.username }}</span>
        </h2>
        
        <div class="publications-list">
            {% for publication in publications %}
                <div class="publication-card">
                    <div class="publication-header">
                        <span class="publication-type">{{ publication.type }} - {{ publication.domain }}</span>
                        <span class="publication-date">{{ publication.created_at|date:"d M Y √† H:i" }}</span>
                    </div>
                    <p class="publication-content">{{ publication.content|truncatewords:30 }}</p>
                    {% if publication.content.split|length > 30 %}
                        <button class="see-more">Voir plus</button>
                    {% endif %}
                    {% if request.user == publication.user %}
                        <a href="{% url 'publication_edit' publication.pk %}" class="edit-link">
                            <i class="fas fa-edit"></i> Modifier
                        </a>
                    {% endif %}
                </div>
            {% empty %}
                <p class="no-publications">Aucune publication pour l'instant.</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Overlay avec des motifs qui changent selon le statut -->
<div id="theme-overlay">
    <div class="hearts-container" id="hearts"></div>
    <div class="sparks-container" id="sparks"></div>
</div>

<style>
/* Variables CSS pour les th√®mes */
:root {
    --primary-color: #3a86ff;
    --primary-dark: #2667cc;
    --primary-light: #e6f0ff;
    --secondary-color: #8338ec;
    --accent-color: #ff006e;
    --dark-color: #1a1a2e;
    --light-color: #f8f9fa;
    --gray-color: #6c757d;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --warning-color: #ffc107;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
    --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    
    /* Couleurs sp√©cifiques aux statuts relationnels */
    --single-color: #3a86ff;
    --relationship-color: #ec4899;
    --married-color: #db2777;
    --complicated-color: #7e22ce;
}

@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom, #f5f7fa, #e4e8f0);
    min-height: 100vh;
    transition: background-color 0.5s ease;
}

/* Th√®mes bas√©s sur le statut relationnel */
body.theme-single {
    --primary-color: var(--single-color);
    --accent-color: #3a86ff;
}

body.theme-relationship {
    --primary-color: var(--relationship-color);
    --accent-color: #ec4899;
    background: linear-gradient(to bottom, #fdf2f8, #fce7f3);
}

body.theme-married {
    --primary-color: var(--married-color);
    --accent-color: #db2777;
    background: linear-gradient(to bottom, #fdf2f8, #fce7f3);
}

body.theme-complicated {
    --primary-color: var(--complicated-color);
    --accent-color: #7e22ce;
    background: linear-gradient(to bottom, #faf5ff, #f3e8ff);
}

.profile-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px 40px;
    animation: fadeIn 1s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Floating Button Style */
.floating-btn {
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform: translateY(0);
}

.floating-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
}

/* Profile Header */
.profile-header {
    position: relative;
    margin-bottom: 100px;
}

.profile-banner {
    height: 250px;
    background: var(--gradient);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
}

.banner-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.2);
}

.animated-shapes {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.shape {
    position: absolute;
    border-radius: 50%;
    opacity: 0.1;
    animation: float 15s infinite linear;
}

.shape-1 {
    width: 100px;
    height: 100px;
    background: white;
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.shape-2 {
    width: 150px;
    height: 150px;
    background: var(--accent-color);
    bottom: 10%;
    right: 10%;
    animation-delay: -5s;
    animation-duration: 20s;
}

.shape-3 {
    width: 70px;
    height: 70px;
    background: var(--warning-color);
    top: 50%;
    right: 20%;
    animation-delay: -10s;
    animation-duration: 25s;
}

@keyframes float {
    0% {
        transform: translate(0, 0) rotate(0deg);
    }
    50% {
        transform: translate(20px, 20px) rotate(180deg);
    }
    100% {
        transform: translate(0, 0) rotate(360deg);
    }
}

/* Avatar Section */
.profile-avatar-section {
    position: relative;
    text-align: center;
    margin-top: -80px;
    z-index: 10;
}

.avatar-container {
    display: inline-block;
    position: relative;
}

/* Couple Avatars */
.couple-avatars {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    position: relative;
}

.partner-avatar {
    position: relative;
    z-index: 1;
    order: 1;
}

.main-avatar {
    position: relative;
    z-index: 2;
    order: 2;
}

.partner-avatar .profile-picture,
.partner-avatar .avatar-initials {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color);
}

.partner-name {
    margin-top: 8px;
    font-size: 0.9rem;
    color: var(--dark-color);
    font-weight: 500;
    text-align: center;
}

/* Single Avatar */
.single-avatar {
    position: relative;
}

.avatar-circle {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background-color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border: 5px solid white;
    position: relative;
    overflow: hidden;
    margin: 0 auto;
}

.pulse-animation {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(58, 134, 255, 0.7);
    }
    70% {
        box-shadow: 0 0 0 15px rgba(58, 134, 255, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(58, 134, 255, 0);
    }
}

.avatar-ring {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 3px solid transparent;
    border-top: 3px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 3s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.profile-picture {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    z-index: 2;
    position: relative;
}

.avatar-initials {
    font-size: 3.5rem;
    font-weight: bold;
    color: var(--primary-color);
}

.profile-info {
    text-align: center;
    margin-top: 20px;
}

.profile-username {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--dark-color);
    margin-bottom: 5px;
    position: relative;
    display: inline-block;
}

.glitch {
    position: relative;
}

.glitch::before,
.glitch::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.glitch::before {
    left: 2px;
    text-shadow: -2px 0 var(--accent-color);
    clip: rect(44px, 450px, 56px, 0);
    animation: glitch-anim 5s infinite linear alternate-reverse;
}

.glitch::after {
    left: -2px;
    text-shadow: -2px 0 var(--primary-color);
    clip: rect(44px, 450px, 56px, 0);
    animation: glitch-anim2 5s infinite linear alternate-reverse;
}

@keyframes glitch-anim {
    0% { clip: rect(42px, 9999px, 44px, 0); }
    5% { clip: rect(12px, 9999px, 59px, 0); }
    10% { clip: rect(48px, 9999px, 29px, 0); }
    15% { clip: rect(42px, 9999px, 73px, 0); }
    20% { clip: rect(63px, 9999px, 27px, 0); }
    25% { clip: rect(34px, 9999px, 55px, 0); }
    30% { clip: rect(86px, 9999px, 73px, 0); }
    35% { clip: rect(20px, 9999px, 20px, 0); }
    40% { clip: rect(26px, 9999px, 60px, 0); }
    45% { clip: rect(25px, 9999px, 66px, 0); }
    50% { clip: rect(57px, 9999px, 98px, 0); }
    55% { clip: rect(5px, 9999px, 46px, 0); }
    60% { clip: rect(82px, 9999px, 31px, 0); }
    65% { clip: rect(54px, 9999px, 27px, 0); }
    70% { clip: rect(28px, 9999px, 99px, 0); }
    75% { clip: rect(45px, 9999px, 69px, 0); }
    80% { clip: rect(23px, 9999px, 85px, 0); }
    85% { clip: rect(54px, 9999px, 84px, 0); }
    90% { clip: rect(45px, 9999px, 47px, 0); }
    95% { clip: rect(24px, 9999px, 23px, 0); }
    100% { clip: rect(32px, 9999px, 92px, 0); }
}

@keyframes glitch-anim2 {
    0% { clip: rect(65px, 9999px, 100px, 0); }
    5% { clip: rect(52px, 9999px, 74px, 0); }
    10% { clip: rect(79px, 9999px, 85px, 0); }
    15% { clip: rect(75px, 9999px, 5px, 0); }
    20% { clip: rect(67px, 9999px, 61px, 0); }
    25% { clip: rect(14px, 9999px, 79px, 0); }
    30% { clip: rect(1px, 9999px, 66px, 0); }
    35% { clip: rect(86px, 9999px, 30px, 0); }
    40% { clip: rect(23px, 9999px, 98px, 0); }
    45% { clip: rect(85px, 9999px, 72px, 0); }
    50% { clip: rect(71px, 9999px, 75px, 0); }
    55% { clip: rect(2px, 9999px, 48px, 0); }
    60% { clip: rect(30px, 9999px, 16px, 0); }
    65% { clip: rect(59px, 9999px, 50px, 0); }
    70% { clip: rect(41px, 9999px, 62px, 0); }
    75% { clip: rect(2px, 9999px, 82px, 0); }
    80% { clip: rect(47px, 9999px, 73px, 0); }
    85% { clip: rect(3px, 9999px, 27px, 0); }
    90% { clip: rect(26px, 9999px, 55px, 0); }
    95% { clip: rect(42px, 9999px, 97px, 0); }
    100% { clip: rect(38px, 9999px, 49px, 0); }
}

.profile-bio {
    color: var(--gray-color);
    margin-bottom: 15px;
    font-size: 1.1rem;
}

/* Relationship Status Badge */
.relationship-status-badge {
    margin-bottom: 15px;
}

.relationship-status-badge span {
    padding: 8px 16px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-block;
}

.status-single {
    background-color: rgba(58, 134, 255, 0.1);
    color: var(--single-color);
    border: 1px solid rgba(58, 134, 255, 0.3);
}

.status-relationship {
    background-color: rgba(236, 72, 153, 0.1);
    color: var(--relationship-color);
    border: 1px solid rgba(236, 72, 153, 0.3);
}

.status-married {
    background-color: rgba(219, 39, 119, 0.1);
    color: var(--married-color);
    border: 1px solid rgba(219, 39, 119, 0.3);
}

.status-complicated {
    background-color: rgba(126, 34, 206, 0.1);
    color: var(--complicated-color);
    border: 1px solid rgba(126, 34, 206, 0.3);
}

.profile-picture-upload {
    margin-top: 15px;
    text-align: center;
}

.upload-button, .save-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    cursor: pointer;
    margin: 0 5px;
    border: none;
}

.save-button {
    background-color: var(--success-color);
}

.report-button {
    background-color: var(--warning-color);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 0 5px;
}

.subscribe-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    border: none;
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 0 5px;
}

.subscribe-btn[data-action="subscribe"] {
    background-color: var(--success-color);
}

.subscribe-btn[data-action="unsubscribe"] {
    background-color: var(--danger-color);
}

.login-prompt {
    color: var(--gray-color);
    font-style: italic;
    font-size: 0.9rem;
}

/* User Details Grid */
.user-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.detail-card {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.detail-card.full-width {
    grid-column: 1 / -1;
}

.detail-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.detail-card-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    color: var(--primary-color);
}

.detail-card-header i {
    font-size: 1.5rem;
    margin-right: 10px;
}

.detail-card-header h3 {
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0;
}

.detail-card-content {
    color: var(--dark-color);
}

.school-item {
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.school-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.school-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.school-years {
    font-size: 0.9rem;
    color: var(--gray-color);
}

.hobbies-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.hobby-tag {
    background-color: var(--primary-color);
    color: white;
    padding: 6px 12px;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 500;
}

.edit-profile {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background-color: var(--primary-color);
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
}

.edit-profile:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 40px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    padding: 25px 15px;
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    text-align: center;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: var(--gradient);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.5s ease;
}

.stat-item:hover {
    transform: translateY(-10px) scale(1.03);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.stat-item:hover::before {
    transform: scaleX(1);
}

.stat-icon {
    font-size: 2rem;
    margin-bottom: 15px;
    color: var(--primary-color);
}

.stat-value {
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--primary-color);
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--gray-color);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 40px;
    justify-content: center;
}

.action-button {
    flex: 1;
    min-width: 150px;
    padding: 15px 20px;
    border-radius: 15px;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.action-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(rgba(255, 255, 255, 0.2), transparent);
    transform: translateY(100%);
    transition: transform 0.4s ease;
}

.action-button:hover::before {
    transform: translateY(0);
}

.action-button i {
    font-size: 1.2rem;
}

.create-publication {
    background: var(--success-color);
    color: white;
}

.create-club {
    background: var(--primary-color);
    color: white;
}

.create-page {
    background: var(--secondary-color);
    color: white;
}

/* Publications Section */
.publications-section {
    margin-top: 40px;
}

.section-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 30px;
    position: relative;
    padding-bottom: 15px;
    text-align: center;
}

.section-title span {
    position: relative;
}

.section-title span::after {
    content: '';
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: var(--gradient);
    border-radius: 2px;
}

.publications-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.publication-card {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.4s ease;
    border: 1px solid rgba(255, 255, 255, 0.5);
    position: relative;
    overflow: hidden;
}

.publication-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: var(--gradient);
    transform: scaleY(0);
    transform-origin: top;
    transition: transform 0.5s ease;
}

.publication-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.publication-card:hover::before {
    transform: scaleY(1);
}

.publication-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    align-items: center;
}

.publication-type {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.publication-date {
    color: var(--gray-color);
    font-size: 0.85rem;
}

.publication-content {
    color: var(--dark-color);
    line-height: 1.7;
    margin-bottom: 15px;
}

.see-more {
    background: none;
    border: none;
    color: var(--primary-color);
    font-weight: 500;
    cursor: pointer;
    padding: 0;
    font-size: 0.9rem;
    position: relative;
}

.see-more::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 1px;
    background: var(--primary-color);
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s ease;
}

.see-more:hover::after {
    transform: scaleX(1);
    transform-origin: left;
}

.edit-link {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    color: var(--gray-color);
    font-size: 0.85rem;
    text-decoration: none;
    margin-top: 15px;
    transition: color 0.3s ease;
}

.edit-link:hover {
    color: var(--primary-color);
}

.no-publications {
    text-align: center;
    color: var(--gray-color);
    padding: 40px;
    font-style: italic;
}

/* Overlay de th√®me */
#theme-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    opacity: 0.1;
    transition: opacity 0.5s ease;
}

.theme-relationship #theme-overlay,
.theme-married #theme-overlay {
    opacity: 0.3;
}

.heart, .spark {
    position: absolute;
    pointer-events: none;
    opacity: 0;
}

.heart {
    color: #ff2a70;
    font-size: 20px;
    animation: fall 5s linear infinite;
}

.spark {
    color: #ffde34;
    font-size: 15px;
    animation: sparkle 2s linear infinite;
}

@keyframes fall {
    0% {
        transform: translateY(-10vh) rotate(0deg);
        opacity: 1;
    }
    100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}

@keyframes sparkle {
    0%, 100% {
        opacity: 0;
        transform: scale(0);
    }
    50% {
        opacity: 1;
        transform: scale(1);
    }
}

/* Mobile Styles */
@media (max-width: 992px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .user-details-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .profile-container {
        padding: 0 15px 30px;
    }

    .profile-banner {
        height: 200px;
    }

    .avatar-circle {
        width: 120px;
        height: 120px;
    }

    .avatar-initials {
        font-size: 2.5rem;
    }

    .profile-username {
        font-size: 2rem;
    }
    
    .couple-avatars {
        flex-direction: column;
        gap: 10px;
    }
    
    .partner-avatar .profile-picture,
    .partner-avatar .avatar-initials {
        width: 80px;
        height: 80px;
        font-size: 1.5rem;
    }

    .action-buttons {
        flex-direction: column;
    }

    .action-button {
        width: 100%;
    }

    .publication-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }

    .publication-date {
        align-self: flex-end;
    }
}

@media (max-width: 576px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .profile-banner {
        height: 180px;
    }

    .avatar-circle {
        width: 100px;
        height: 100px;
    }

    .avatar-initials {
        font-size: 2rem;
    }

    .profile-username {
        font-size: 1.8rem;
    }

    .stat-value {
        font-size: 1.8rem;
    }

    .section-title {
        font-size: 1.5rem;
    }
    
    .couple-avatars {
        flex-direction: column;
    }
    
    .partner-avatar .profile-picture,
    .partner-avatar .avatar-initials {
        width: 70px;
        height: 70px;
        font-size: 1.2rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Appliquer le th√®me bas√© sur le statut relationnel
    function applyRelationshipTheme() {
        const relationshipStatus = '{{ profile_user.relationship_status }}'.toLowerCase();
        document.body.classList.remove('theme-single', 'theme-relationship', 'theme-married', 'theme-complicated');
        
        if (relationshipStatus) {
            document.body.classList.add(`theme-${relationshipStatus}`);
            
            // Ajouter des animations sp√©ciales pour les statuts de couple
            if (relationshipStatus === 'relationship' || relationshipStatus === 'married') {
                createHearts();
            } else if (relationshipStatus === 'complicated') {
                createSparks();
            }
        }
    }
    
    // Cr√©er des c≈ìurs qui tombent
    function createHearts() {
        const heartsContainer = document.getElementById('hearts');
        heartsContainer.innerHTML = '';
        
        for (let i = 0; i < 20; i++) {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.innerHTML = '‚ù§';
            heart.style.left = `${Math.random() * 100}%`;
            heart.style.animationDelay = `${Math.random() * 5}s`;
            heartsContainer.appendChild(heart);
        }
    }
    
    // Cr√©er des √©tincelles
    function createSparks() {
        const sparksContainer = document.getElementById('sparks');
        sparksContainer.innerHTML = '';
        
        for (let i = 0; i < 15; i++) {
            const spark = document.createElement('div');
            spark.classList.add('spark');
            spark.innerHTML = '‚ú®';
            spark.style.left = `${Math.random() * 100}%`;
            spark.style.top = `${Math.random() * 100}%`;
            spark.style.animationDelay = `${Math.random() * 2}s`;
            sparksContainer.appendChild(spark);
        }
    }
    
    // Appliquer le th√®me au chargement
    applyRelationshipTheme();
    
    // Toggle full publication content
    document.querySelectorAll('.see-more').forEach(button => {
        button.addEventListener('click', function() {
            const publicationContent = this.parentElement.querySelector('.publication-content');
            publicationContent.style.webkitLineClamp = 'unset';
            this.style.display = 'none';
        });
    });

    // Animated counter for stats
    const statValues = document.querySelectorAll('.stat-value');
    
    const options = {
        threshold: 0.5
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const statValue = entry.target;
                const target = parseInt(statValue.getAttribute('data-count'));
                const duration = 2000; // 2 seconds
                const increment = target / (duration / 16); // 60fps
                let current = 0;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        clearInterval(timer);
                        current = target;
                    }
                    statValue.textContent = Math.round(current);
                }, 16);
                
                observer.unobserve(statValue);
            }
        });
    }, options);
    
    statValues.forEach(statValue => {
        observer.observe(statValue);
    });

    // Profile picture upload preview
    const profilePictureInput = document.getElementById('profile-picture-input');
    if (profilePictureInput) {
        profilePictureInput.addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.querySelector('.profile-picture').src = e.target.result;
                    document.querySelector('.avatar-initials').style.display = 'none';
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        });
    }
});

// Subscription functionality
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

document.querySelectorAll('.subscribe-btn').forEach(button => {
    button.addEventListener('click', function() {
        const accountId = this.dataset.accountId;
        const action = this.dataset.action;
        const url = action === 'subscribe' ? `/subscribe/${accountId}/` : `/unsubscribe/${accountId}/`;

        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'subscribed') {
                this.innerHTML = '<i class="fas fa-user-minus"></i>';
                this.dataset.action = 'unsubscribe';
                this.style.backgroundColor = '#f44336';
                
                // Animation for subscription
                this.animate([
                    { transform: 'scale(1)' },
                    { transform: 'scale(1.2)' },
                    { transform: 'scale(1)' }
                ], {
                    duration: 300,
                    iterations: 1
                });
            } else if (data.status === 'unsubscribed') {
                this.innerHTML = '<i class="fas fa-user-plus"></i>';
                this.dataset.action = 'subscribe';
                this.style.backgroundColor = '#4CAF50';
                
                // Animation for unsubscription
                this.animate([
                    { transform: 'scale(1)' },
                    { transform: 'scale(0.8)' },
                    { transform: 'scale(1)' }
                ], {
                    duration: 300,
                    iterations: 1
                });
            } else {
                alert(data.message || 'Une erreur est survenue.');
            }
        })
        .catch(error => console.error('Erreur:', error));
    });
});
</script>
{% endblock %}